<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è‹±å˜èªã—ã‚Šã¨ã‚Šï¼ˆã‚¢ãƒ¼ã‚±ãƒ¼ãƒ‰ï¼‰</title>
  <style>
    :root{
      --bg0:#05060b;
      --bg1:#070a12;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.09);
      --line: rgba(255,255,255,.14);
      --text:#e9eef7;
      --muted: rgba(233,238,247,.70);

      --neon1:#7c4dff;
      --neon2:#00e5ff;
      --neon3:#00ff8a;
      --bad:#ff3d71;
      --warn:#ffd166;

      --r: 18px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 0 24px rgba(0,229,255,.10);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 20% 0%, rgba(124,77,255,.25), transparent 60%),
        radial-gradient(900px 700px at 90% 10%, rgba(0,229,255,.18), transparent 55%),
        radial-gradient(700px 600px at 60% 100%, rgba(0,255,138,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 60%, #04050a);
      overflow-x:hidden;
    }

    /* ã†ã£ã™ã‚‰ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³ */
    body::before{
      content:"";
      position:fixed; inset:0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.05) 0px,
        rgba(255,255,255,.05) 1px,
        transparent 3px,
        transparent 6px
      );
      opacity:.12;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    .wrap{
      max-width: 1100px;
      margin: 28px auto 40px;
      padding: 0 16px;
    }

    .hero{
      background:
        radial-gradient(900px 400px at 20% 20%, rgba(0,229,255,.18), transparent 60%),
        radial-gradient(700px 300px at 80% 20%, rgba(124,77,255,.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border: 1px solid rgba(0,229,255,.12);
      border-radius: calc(var(--r) + 10px);
      padding: 18px 18px 14px;
      box-shadow: var(--shadow), var(--shadow2);
      backdrop-filter: blur(10px);
    }

    h1{
      margin:0 0 8px;
      font-size: 34px;
      letter-spacing:.04em;
      text-shadow: 0 0 10px rgba(0,229,255,.35), 0 0 18px rgba(124,77,255,.22);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .badge{
      font-size: 14px;
      padding: 4px 10px;
      border-radius: 999px;
      border:1px solid rgba(0,229,255,.25);
      background: rgba(0,0,0,.25);
      box-shadow: 0 0 18px rgba(0,229,255,.10);
      color: var(--muted);
    }
    .desc{
      margin:0;
      color: var(--muted);
      line-height: 1.55;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.35fr 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      h1{ font-size: 28px; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border: 1px solid rgba(0,229,255,.12);
      border-radius: var(--r);
      padding: 14px;
      box-shadow: var(--shadow), var(--shadow2);
      backdrop-filter: blur(10px);
      position: relative;
    }

    .row{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .stat{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(0,229,255,.18);
      background: rgba(0,0,0,.20);
      box-shadow: 0 0 18px rgba(0,229,255,.08);
      color: var(--muted);
      font-size: 14px;
    }
    .stat b{
      color: var(--text);
      font-size: 15px;
      letter-spacing:.06em;
      padding: 2px 8px;
      border-radius: 999px;
      border:1px solid rgba(124,77,255,.22);
      background: rgba(124,77,255,.12);
      box-shadow: 0 0 16px rgba(124,77,255,.10);
      min-width: 28px;
      text-align:center;
    }

    .spacer{ flex:1; }

    button{
      cursor:pointer;
      border-radius: 12px;
      border:1px solid rgba(0,229,255,.25);
      background: rgba(0,0,0,.25);
      color: var(--text);
      padding: 10px 12px;
      font-size: 14px;
      box-shadow: 0 0 0 1px rgba(124,77,255,.12), 0 0 18px rgba(0,229,255,.10);
      transition: transform .08s ease, box-shadow .12s ease, border-color .12s ease;
    }
    button:hover{
      box-shadow: 0 0 0 1px rgba(0,229,255,.35), 0 0 26px rgba(0,229,255,.18), 0 0 18px rgba(124,77,255,.12);
      transform: translateY(-1px);
    }
    button:active{ transform: translateY(0px) scale(.99); }
    button.primary{
      background: linear-gradient(180deg, rgba(0,229,255,.18), rgba(0,0,0,.25));
    }
    button.danger{
      border-color: rgba(255,61,113,.35);
      box-shadow: 0 0 0 1px rgba(255,61,113,.18), 0 0 18px rgba(255,61,113,.12);
    }

    .field{
      margin-top: 12px;
    }
    label{
      display:block;
      font-weight: 650;
      margin: 4px 0 8px;
    }

    .inputRow{
      display:flex;
      gap:10px;
      align-items:center;
    }
    input[type="text"]{
      width: 100%;
      padding: 14px 14px;
      font-size: 16px;
      border-radius: 12px;
      border:1px solid rgba(0,229,255,.28);
      background: rgba(0,0,0,.25);
      color: var(--text);
      box-shadow: 0 0 0 1px rgba(124,77,255,.10), 0 0 18px rgba(0,229,255,.10);
      transition: box-shadow .12s ease, border-color .12s ease;
    }
    input[type="text"]::placeholder{ color: rgba(233,238,247,.45); }
    input[type="text"]:focus{
      outline:none;
      box-shadow: 0 0 0 2px rgba(0,229,255,.22), 0 0 30px rgba(0,229,255,.18);
    }

    .subhint{
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    .controls{
      display:flex;
      gap: 12px;
      align-items:center;
      flex-wrap: wrap;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed rgba(255,255,255,.12);
    }

    .seg{
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(0,229,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size: 14px;
    }
    .seg .radio{
      display:flex; align-items:center; gap:8px;
    }
    .seg input{ transform: translateY(1px); }

    select{
      border-radius: 999px;
      border:1px solid rgba(0,229,255,.22);
      background: rgba(0,0,0,.22);
      color: var(--text);
      padding: 10px 12px;
      box-shadow: 0 0 18px rgba(0,229,255,.08);
    }

    .msg{
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      min-height: 44px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .msg.good{ border-color: rgba(0,255,138,.25); color: rgba(0,255,138,.95); }
    .msg.bad{ border-color: rgba(255,61,113,.30); color: rgba(255,61,113,.95); }
    .msg.warn{ border-color: rgba(255,209,102,.35); color: rgba(255,209,102,.98); }

    .log{
      margin-top: 12px;
      border-radius: 14px;
      border:1px solid rgba(0,229,255,.12);
      background: rgba(0,0,0,.22);
      min-height: 220px;
      padding: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Noto Sans Mono", monospace;
      font-size: 13px;
      line-height: 1.55;
      overflow:auto;
    }
    .log .you{ color: rgba(0,229,255,.95); }
    .log .cpu{ color: rgba(0,255,138,.95); }
    .log .sys{ color: rgba(255,209,102,.98); }

    .sideTitle{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:10px;
      margin: 2px 0 10px;
    }
    .sideTitle h2{
      margin:0;
      font-size: 18px;
      letter-spacing:.02em;
      text-shadow: 0 0 10px rgba(0,229,255,.18);
    }
    .pillWrap{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(0,229,255,.18);
      background: rgba(0,0,0,.18);
      box-shadow: 0 0 18px rgba(0,229,255,.08);
      font-size: 13px;
      user-select:none;
    }
    .pill small{
      color: rgba(233,238,247,.55);
      font-size: 12px;
    }
    .pill.clickable{
      cursor: pointer;
      transition: transform .08s ease, box-shadow .12s ease;
    }
    .pill.clickable:hover{
      transform: translateY(-1px);
      box-shadow: 0 0 24px rgba(0,229,255,.12);
    }

    .note{
      margin-top: 10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
      border-top: 1px dashed rgba(255,255,255,.12);
      padding-top: 10px;
    }

    footer{
      margin-top: 14px;
      text-align:center;
      color: rgba(233,238,247,.55);
      font-size: 12px;
    }

    /* Arcade: success/fail anim */
    .arcade-good{ animation: popGlow .25s ease-out 1; }
    .arcade-bad{  animation: shake .18s ease-in-out 2; }
    @keyframes popGlow{
      from{ filter: brightness(1); }
      to  { filter: brightness(1.35); }
    }
    @keyframes shake{
      0%{ transform: translateX(0); }
      25%{ transform: translateX(-5px); }
      50%{ transform: translateX(5px); }
      75%{ transform: translateX(-3px); }
      100%{ transform: translateX(0); }
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; }
      body::before{ display:none; }
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.72);
      border: 1px solid rgba(0,229,255,.20);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.45), 0 0 18px rgba(0,229,255,.10);
      color: var(--text);
      font-size: 13px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .12s ease, transform .12s ease;
      max-width: min(92vw, 760px);
      text-align:center;
      z-index: 999;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>è‹±å˜èªã—ã‚Šã¨ã‚Š <span class="badge">GAME CENTER MODE ğŸ‘¾</span></h1>
      <p class="desc">
        å…¥åŠ›æ¬„ã« <b>aã€œzï¼ˆå°æ–‡å­—ï¼‰</b>ã§è‹±å˜èªã‚’å…¥ã‚Œã¦ã€<b>Enter</b> ã¾ãŸã¯ <b>é€ä¿¡</b>ã€‚æ¬¡ã®å˜èªã¯å‰ã®å˜èªã®<b>æœ€å¾Œã®æ–‡å­—</b>ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚è¿·ã£ãŸã‚‰ <b>ãƒ’ãƒ³ãƒˆ</b>ï¼
      </p>
    </div>

    <div class="grid">
      <div class="card" id="leftCard">
        <div class="row" style="margin-bottom:10px;">
          <div class="stat">æ¬¡ã®é ­æ–‡å­— <b id="need">è‡ªç”±</b></div>
          <div class="stat">ã‚¿ãƒ¼ãƒ³ <b id="turns">0</b></div>
          <div class="stat">é€£å‹ <b id="streak">0</b></div>
          <div class="spacer"></div>
          <button class="danger" id="resetBtn" type="button" title="æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <div class="field">
          <label for="wordInput">ã‚ãªãŸã®å˜èª</label>
          <div class="inputRow">
            <input id="wordInput" type="text" inputmode="text" autocomplete="off" spellcheck="false"
                   placeholder="ä¾‹ï¼š apple / school / egg" aria-label="è‹±å˜èªå…¥åŠ›æ¬„" />
            <button class="primary" id="sendBtn" type="button">é€ä¿¡</button>
            <button id="hintBtn" type="button">ãƒ’ãƒ³ãƒˆ</button>
          </div>
          <p class="subhint">
            ãƒ¢ãƒ¼ãƒ‰ã¯ã€Œå³æ ¼ï¼ˆè¾æ›¸ã«ã‚ã‚‹å˜èªã ã‘ï¼‰ã€ã¨ã€Œã‚†ã‚‹ã‚ï¼ˆè¾æ›¸ã«ãªãã¦ã‚‚OKï¼‹å€™è£œè¡¨ç¤ºï¼‰ã€ã‚’åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã™ã€‚
          </p>

          <div class="controls">
            <div class="seg" role="group" aria-label="ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿">
              <span>ãƒ¢ãƒ¼ãƒ‰ï¼š</span>
              <label class="radio"><input type="radio" name="mode" value="strict" checked> å³æ ¼</label>
              <label class="radio"><input type="radio" name="mode" value="suggest"> ã‚†ã‚‹ã‚</label>
            </div>

            <div class="seg" role="group" aria-label="ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿å¼·ã•">
              <span>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ï¼š</span>
              <select id="cpuLevel" aria-label="ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å¼·ã•">
                <option value="easy">ã‹ã‚“ãŸã‚“</option>
                <option value="normal" selected>ãµã¤ã†</option>
                <option value="hard">ã‚€ãšã‹ã—ã„</option>
              </select>
            </div>
          </div>

          <div class="msg" id="message" aria-live="polite"></div>
          <div class="log" id="log" aria-live="polite" aria-label="å±¥æ­´ãƒ­ã‚°"></div>
        </div>
      </div>

      <div class="card">
        <div class="sideTitle">
          <h2>ä½¿ã£ãŸå˜èª</h2>
          <div class="pill"><small>ãƒ”ãƒ«è¡¨ç¤ºï¼å±¥æ­´</small></div>
        </div>

        <div class="pillWrap" id="usedPills" aria-label="ä½¿ç”¨æ¸ˆã¿å˜èªä¸€è¦§"></div>

        <div class="pill" style="margin-top:10px;">
          ãƒŸãƒ‹è¾æ›¸èªæ•° <b id="dictSize" style="margin-left:6px;">0</b>
        </div>

        <div class="note">
          â€»ã“ã®ã‚²ãƒ¼ãƒ ã¯<b>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®å°ã•ãªè¾æ›¸</b>ã§å‹•ãã¾ã™ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§å®Œçµï¼‰ã€‚<br/>
          å³æ ¼ãƒ¢ãƒ¼ãƒ‰ã§ã¯<b>è¾æ›¸ã«ãªã„å˜èªã¯NG</b>ã€‚ã‚†ã‚‹ã‚ãƒ¢ãƒ¼ãƒ‰ã§ã¯<b>OK</b>ã«ã—ã¦ã€è¿‘ã„å€™è£œã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
          <div class="pillWrap" id="hintPills" style="margin-top:10px;"></div>
        </div>
      </div>
    </div>

    <footer>
      æ³¨æ„ï¼šå°æ–‡å­—ã®ã¿ï¼åŒã˜å˜èªã¯1å›ã ã‘ï¼ã—ã‚Šã¨ã‚Šãƒ«ãƒ¼ãƒ«ã€‚æ¥½ã—ã‚‚ã†ğŸ™‚
    </footer>
  </div>

  <div class="toast" id="toast" aria-live="polite"></div>

  <script>
    (function(){
      "use strict";

      const VOCAB = [
        "apple","ant","animal","answer","art","actor","area",
        "baby","back","bag","ball","band","bank","base","basket","beach","bear","beauty","because","bed","bee","begin","bird","birthday","black","blue","board","book","bottle","box","brain","bread","break","bridge","brother","brown","bus","busy","button",
        "cake","camera","camp","candle","candy","capital","car","card","care","carry","cat","chair","change","chicken","child","chocolate","city","class","classroom","clean","clock","close","cloud","coach","coffee","color","comic","computer","cook","cookie","cool","copy","corner","country","course","cousin","crayon","culture","cup",
        "dance","dark","day","desk","dictionary","dinner","dog","door","dream","drink","driver","drop",
        "eagle","ear","earth","east","easy","eat","egg","eight","elephant","email","energy","engine","english","enjoy","entry","error","event","exam","example","exercise","exit","eye",
        "face","family","fan","fast","father","favorite","feel","field","fight","film","find","fire","first","fish","five","flower","fly","food","forest","friend","frog","front","fruit","fun","future",
        "game","garden","gate","gift","girl","glass","glove","goat","gold","good","grade","great","green","group","guitar",
        "hair","half","hand","happy","hard","hat","head","health","help","hero","hill","history","home","homework","horse","hospital","hot","house","human",
        "ice","idea","image","important","inside","internet",
        "jacket","japan","job","join","juice",
        "key","kid","kind","king","kitchen","kite",
        "lake","language","last","late","laugh","leaf","learn","lesson","letter","library","light","like","line","lion","listen","live","long","look","love","lunch",
        "machine","magazine","make","man","market","math","meal","meet","message","middle","milk","minute","model","money","month","morning","mouse","movie","music",
        "name","nature","near","need","never","new","night","nine","noise","north","note","number",
        "ocean","office","often","one","open","orange","order","outside",
        "page","paint","paper","parent","park","party","pen","pencil","people","person","phone","photo","piano","picture","piece","pink","pizza","place","plan","play","player","please","point","police","popular","power","practice","present","problem","project",
        "quiz",
        "rain","read","ready","real","reason","red","remember","repeat","reply","report","rest","river","road","robot","room","rule","run",
        "sad","safe","salad","school","science","score","sea","season","second","secret","see","send","sentence","share","ship","shoe","short","show","singer","sister","skill","sleep","small","smart","smile","snake","snow","soccer","sound","space","sport","spring","star","start","station","street","strong","student","study","summer","sun","super",
        "table","taco","talk","teacher","team","test","text","thank","thing","think","three","time","today","together","tomorrow","train","travel","tree","true","try","tuesday","turn","two",
        "umbrella","under","unit","use","user",
        "vacation","video","village","voice",
        "walk","wall","want","water","week","welcome","west","what","white","window","winter","with","woman","word","work","world","write",
        "xray",
        "year","yellow","yes","yesterday","young",
        "zebra","zero","zoo"
      ];

      const input = document.getElementById("wordInput");
      const sendBtn = document.getElementById("sendBtn");
      const hintBtn = document.getElementById("hintBtn");
      const resetBtn = document.getElementById("resetBtn");
      const needEl = document.getElementById("need");
      const turnsEl = document.getElementById("turns");
      const streakEl = document.getElementById("streak");
      const msgEl = document.getElementById("message");
      const logEl = document.getElementById("log");
      const usedPills = document.getElementById("usedPills");
      const hintPills = document.getElementById("hintPills");
      const dictSizeEl = document.getElementById("dictSize");
      const toastEl = document.getElementById("toast");
      const cpuLevelEl = document.getElementById("cpuLevel");

      const DICT = Array.from(new Set(VOCAB.map(w => w.toLowerCase()))).filter(w => /^[a-z]{2,}$/.test(w));
      const DICT_SET = new Set(DICT);
      dictSizeEl.textContent = String(DICT.length);

      let used = new Set();
      let need = "";
      let turns = 0;
      let streak = 0;
      let alive = true;

      function arcadeFlash(kind){
        input.classList.remove("arcade-good","arcade-bad");
        void input.offsetWidth;
        input.classList.add(kind === "good" ? "arcade-good" : "arcade-bad");
      }

      function setMessage(text, tone=""){
        msgEl.className = "msg" + (tone ? " " + tone : "");
        msgEl.textContent = text;
      }

      let toastTimer = null;
      function toast(text){
        toastEl.textContent = text;
        toastEl.classList.add("show");
        clearTimeout(toastTimer);
        toastTimer = setTimeout(()=> toastEl.classList.remove("show"), 1200);
      }

      function appendLog(line, cls="sys"){
        const div = document.createElement("div");
        div.className = cls;
        div.textContent = line;
        logEl.appendChild(div);
        logEl.scrollTop = logEl.scrollHeight;
      }

      function renderUsedPills(){
        usedPills.innerHTML = "";
        for(const w of Array.from(used)){
          const p = document.createElement("span");
          p.className = "pill";
          p.textContent = w;
          usedPills.appendChild(p);
        }
      }

      function renderHintPills(list){
        hintPills.innerHTML = "";
        if(!list || list.length === 0) return;
        for(const w of list){
          const p = document.createElement("span");
          p.className = "pill clickable";
          p.title = "ã‚¯ãƒªãƒƒã‚¯ã§å…¥åŠ›æ¬„ã«å…¥ã‚Œã‚‹";
          p.innerHTML = `${w} <small>click</small>`;
          p.addEventListener("click", ()=>{
            input.value = w;
            input.focus();
          });
          hintPills.appendChild(p);
        }
      }

      function getMode(){
        return document.querySelector('input[name="mode"]:checked')?.value || "strict";
      }

      function updateNeed(){
        needEl.textContent = need ? need : "è‡ªç”±";
      }
      function updateStats(){
        turnsEl.textContent = String(turns);
        streakEl.textContent = String(streak);
      }

      function validate(word){
        if(word.length === 0) return { ok:false, msg:"è‹±å˜èªã‚’å…¥åŠ›ã—ã¦ã­ã€‚", tone:"warn" };
        if(!/^[a-z]+$/.test(word)) return { ok:false, msg:"å°æ–‡å­— aã€œz ã ã‘ã§å…¥åŠ›ã—ã¦ã­ã€‚", tone:"bad" };
        if(word.length < 2) return { ok:false, msg:"2æ–‡å­—ä»¥ä¸Šã®å˜èªã§ï¼", tone:"bad" };
        if(used.has(word)) return { ok:false, msg:`ã€Œ${word}ã€ã¯ã‚‚ã†ä½¿ã£ãŸã‚ˆï¼ˆé‡è¤‡ç¦æ­¢ï¼‰`, tone:"bad" };
        if(need && word[0] !== need) return { ok:false, msg:`ãƒ«ãƒ¼ãƒ«ï¼šæ¬¡ã¯ã€Œ${need}ã€ã‹ã‚‰ï¼`, tone:"bad" };

        const mode = getMode();
        if(mode === "strict" && !DICT_SET.has(word)){
          return { ok:false, msg:"ãƒŸãƒ‹è¾æ›¸ã«ãªã„å˜èªï¼ˆå³æ ¼ãƒ¢ãƒ¼ãƒ‰ï¼‰ã€‚ãƒ’ãƒ³ãƒˆã‹ã€Œã‚†ã‚‹ã‚ã€ã¸ã€‚", tone:"warn" };
        }

        renderHintPills([]);
        return { ok:true };
      }

      function possibleWords(startLetter){
        return DICT.filter(w => !used.has(w) && (!startLetter || w[0] === startLetter));
      }

      function chooseCpuWord(startLetter){
        const candidates = possibleWords(startLetter);
        if(candidates.length === 0) return "";
        const level = cpuLevelEl.value || "normal";

        function opponentOptionsCount(myWord){
          const next = myWord[myWord.length - 1];
          return possibleWords(next).length;
        }

        if(level === "normal"){
          return candidates[Math.floor(Math.random()*candidates.length)];
        }

        let best = candidates[0];
        let bestScore = opponentOptionsCount(best);

        for(const w of candidates){
          const c = opponentOptionsCount(w);
          if(level === "easy"){
            if(c > bestScore){ best = w; bestScore = c; }
          }else if(level === "hard"){
            if(c < bestScore){ best = w; bestScore = c; }
          }
        }
        return best;
      }

      function applyWord(by, word){
        used.add(word);
        renderUsedPills();
        appendLog(by === "you" ? `You: ${word}` : `Computer: ${word}`, by === "you" ? "you" : "cpu");
        need = word[word.length - 1];
        updateNeed();
      }

      function win(){
        alive = false;
        setMessage("ğŸ‰ è©°ã¾ã›ãŸï¼ã‚ãªãŸã®å‹ã¡ï¼", "good");
        toast("ã‚ãªãŸã®å‹ã¡ï¼");
      }

      function cpuTurn(){
        if(!alive) return;
        const cpuWord = chooseCpuWord(need);
        if(!cpuWord){
          streak += 1;
          updateStats();
          win();
          return;
        }
        applyWord("cpu", cpuWord);
        if(possibleWords(need).length === 0){
          alive = false;
          setMessage("ğŸ’¥ è¿”ã›ã‚‹å˜èªãŒãªã„â€¦ã‚ãªãŸã®è² ã‘ï¼", "bad");
          toast("è² ã‘â€¦ï¼");
          streak = 0;
          updateStats();
        }
      }

      function userTurn(){
        if(!alive) return;

        const word = input.value.trim().toLowerCase();
        input.value = "";

        const v = validate(word);
        if(!v.ok){
          setMessage(v.msg, v.tone || "warn");
          toast(v.msg);
          arcadeFlash("bad");
          input.focus();
          return;
        }

        applyWord("you", word);
        turns += 1;
        updateStats();
        setMessage(`OKï¼æ¬¡ã¯ã€Œ${need}ã€ã‹ã‚‰ã€‚`, "good");
        toast("OK!");
        arcadeFlash("good");
        input.focus();

        if(possibleWords(need).length === 0){
          streak += 1;
          updateStats();
          win();
          return;
        }

        setTimeout(cpuTurn, 220);
      }

      function showHints(){
        if(!alive) return;
        const list = possibleWords(need).slice(0, 5);
        if(list.length === 0){
          win();
          return;
        }
        renderHintPills(list);
        setMessage(`ãƒ’ãƒ³ãƒˆï¼š${list.join(", ")}ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å…¥åŠ›ã§ãã‚‹ã‚ˆï¼‰`, "warn");
        toast("ãƒ’ãƒ³ãƒˆï¼");
      }

      function reset(){
        used = new Set();
        need = "";
        turns = 0;
        streak = 0;
        alive = true;

        logEl.innerHTML = "";
        renderUsedPills();
        renderHintPills([]);

        updateNeed();
        updateStats();
        setMessage("ã‚¹ã‚¿ãƒ¼ãƒˆï¼šè‹±å˜èªã‚’å…¥ã‚Œã¦ã¿ã‚ˆã†ï¼ˆä¾‹ï¼šappleï¼‰", "warn");
        appendLog("Start: è‹±å˜èªã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šappleï¼‰", "sys");
        input.value = "";
        input.focus();
      }

      sendBtn.addEventListener("click", userTurn);
      hintBtn.addEventListener("click", showHints);
      resetBtn.addEventListener("click", reset);

      input.addEventListener("keydown", (e) => {
        if(e.key === "Enter"){
          e.preventDefault();
          userTurn();
        }
      });

      document.querySelectorAll('input[name="mode"]').forEach(r=>{
        r.addEventListener("change", ()=>{
          renderHintPills([]);
          setMessage("ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸã€‚", "warn");
          input.focus();
        });
      });

      cpuLevelEl.addEventListener("change", ()=>{
        toast("CPUãƒ¬ãƒ™ãƒ«å¤‰æ›´");
        input.focus();
      });

      reset();
    })();
  </script>
</body>
</html>
